{% extends 'main_app/base.html' %}
{% load static %}

{% block page_title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="card mb-4">
  <div class="card-header">
    <form method="get" class="row g-2">
      <div class="col-md-3">
        <label><strong>Academic Year</strong></label>
        <select name="year" class="form-control">
          <option value="">All</option>
          {% for y in years %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label><strong>Warehouse</strong></label>
        <select name="warehouse" class="form-control">
          <option value="">All</option>
          {% for wh in warehouses %}
            <option value="{{ wh.id }}" {% if wh.id|stringformat:"s" == selected_warehouse %}selected{% endif %}>{{ wh.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label><strong>SKU Search</strong></label>
        <input type="text" name="sku" value="{{ selected_sku }}" class="form-control" placeholder="Enter SKU">
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Filter</button>
      </div>
    </form>
  </div>

  <div class="card-body">
    <h5 class="mb-3">Recent Orders</h5>
    <div class="table-responsive mb-4">
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Academic Year</th>
            <th>Branch (Warehouse)</th>
            <th>Student</th>
            <th>SKU Code</th>
            <th>Class</th>
            <th>Quantity</th>
            <th>Paid Date</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
          <tr>
            <td>{{ order.academic_year }}</td>
            <td>{{ order.warehouse.name }}</td>
            <td>{{ order.student_name }}</td>
            <td>{{ order.sku.sku }}</td>
            <td>{{ order.student_class }}</td>
            <td>{{ order.quantity }}</td>
            <td>{{ order.paid_date }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7">No orders found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <h5 class="mb-3">SKU-wise Inventory Planning</h5>
    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead class="table-primary">
          <tr>
            <th>Academic Year</th>
            <th>SKU Code</th>
            <th>Product Description</th>
            <th>Total Ordered Qty</th>
            <th>Total Received Qty</th>
            <th>Pending Qty</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for item in summary %}
          <tr class="{% if item.alert %}table-danger{% endif %}">
            <td>{{ item.academic_year }}</td>
            <td>{{ item.sku }}</td>
            <td>{{ item.product }}</td>
            <td>{{ item.total_ordered }}</td>
            <td>{{ item.total_received }}</td>
            <td>{{ item.pending }}</td>
            <td>
              {% if item.pending > 0 %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% else %}
                <span class="badge bg-success">Fulfilled</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="7">No SKU summary available.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
